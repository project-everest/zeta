    class @name@;

    class @name@_ParamSerializer : public AppParam
    {
    public:
        @name@_ParamSerializer(const @name@* fn);
        virtual size_t Serialize (uint8_t *buf, size_t size) const override;
        virtual size_t SerializationLength() const override;
        virtual void Serialize4Hash(Hasher& hasher) const override;

    private:
        const @name@* fn_;
    };

    class @name@ : public AppTransFn
    {
    public:
        @constructor@

        @if_output@
        using out_t = @output_type@;
        @end_if_output@

        const AppParam& GetParam() const override
        {
            return paramSerializer_;
        }

        const Record& GetRecord(int idx) const override;

        Value GetPostValue(int idx) const override;

        bool Touches(int idx) const override;

        void SetOutput(ReadLog& log) override;

        @if_output@
        const out_t *GetOutput() const
        {
            return out_;
        }
        @end_if_output@

    private:

        friend class @name@_ParamSerializer;

        @param@
        @name@_ParamSerializer paramSerializer_;
        @if_output@
        out_t out_;
        @end_if_output@
    };
